if(WITH_FFMPEG STREQUAL "BUNDLED")
	message(STATUS "Enabling Vorbis bundled in FFmpeg build")

	include(GNUInstallDirs)

	set(VORBIS_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/src")
	set(VORBIS_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}/vorbis-build")
	set(VORBIS_LIBRARY "${FFMPEG_EXTERNAL_PATH}/${CMAKE_INSTALL_LIBDIR}/${CMAKE_STATIC_LIBRARY_PREFIX}vorbis${CMAKE_STATIC_LIBRARY_SUFFIX}")
	set(VORBIS_OGG_LIBRARY_HINT "${FFMPEG_EXTERNAL_PATH}/${CMAKE_INSTALL_LIBDIR}/${CMAKE_STATIC_LIBRARY_PREFIX}ogg${CMAKE_STATIC_LIBRARY_SUFFIX}")
	set(VORBIS_OGG_INCLUDE_HINT "${FFMPEG_EXTERNAL_PATH}/include")
	file(MAKE_DIRECTORY "${VORBIS_BUILD_DIR}")

	add_custom_command(
		OUTPUT "${VORBIS_LIBRARY}"
		COMMAND ${CMAKE_COMMAND} -S ${VORBIS_SRC_DIR} -B ${VORBIS_BUILD_DIR} -G Ninja
			-DBUILD_SHARED_LIBS=OFF
			-DBUILD_TESTING=OFF
			-DCMAKE_INSTALL_PREFIX=${FFMPEG_EXTERNAL_PATH}
			-DOGG_LIBRARY=${VORBIS_OGG_LIBRARY_HINT}
			-DOGG_INCLUDE_DIR=${VORBIS_OGG_INCLUDE_HINT}
		COMMAND ${CMAKE_COMMAND} --build ${VORBIS_BUILD_DIR} --target install
		WORKING_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}"
		COMMENT "Configuring and installing vorbis to ${FFMPEG_EXTERNAL_PATH}"
		VERBATIM
		DEPENDS ogg_bundled
	)

	add_custom_target(vorbis_bundled DEPENDS "${VORBIS_LIBRARY}")

	# Update FFmpeg options
	set(FFMPEG_MESON_OPTIONS
		${FFMPEG_MESON_OPTIONS}
		"-Dlibvorbis=enabled"
		"-Dlibvorbisenc=enabled"
		PARENT_SCOPE
	)
endif()
