# Initialize directory variables
set(BOOTSTRAP_SRC_DIR "${CMAKE_CURRENT_LIST_DIR}")
set(BOOTSTRAP_BIN_DIR "${CMAKE_CURRENT_BINARY_DIR}")
set(BOOTSTRAP_SCRIPTS_DIR "${BOOTSTRAP_BIN_DIR}/scripts")
set(BOOTSTRAP_SCRIPTS_ENV_DIR "${BOOTSTRAP_SCRIPTS_DIR}")
set(BOOTSTRAP_SCRIPTS_CMAKE_DIR "${BOOTSTRAP_SCRIPTS_ENV_DIR}/cmake")
set(BOOTSTRAP_SCRIPTS_GIT_DIR "${BOOTSTRAP_SCRIPTS_ENV_DIR}/git")
set(BOOTSTRAP_SCRIPTS_MESON_DIR "${BOOTSTRAP_SCRIPTS_ENV_DIR}/meson")
set(BOOTSTRAP_SCRIPTS_NINJA_DIR "${BOOTSTRAP_SCRIPTS_ENV_DIR}/ninja")
set(BOOTSTRAP_INSTALL_DIR "${CMAKE_CURRENT_BINARY_DIR}/install")
set(BOOTSTRAP_INSTALL_LIB_DIR "${BOOTSTRAP_INSTALL_DIR}/${CMAKE_INSTALL_LIBDIR}")
set(BOOTSTRAP_INSTALL_BIN_DIR "${BOOTSTRAP_INSTALL_DIR}/${CMAKE_INSTALL_BINDIR}")
set(BOOTSTRAP_INSTALL_INCLUDE_DIR "${BOOTSTRAP_INSTALL_DIR}/${CMAKE_INSTALL_INCLUDEDIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_SCRIPTS_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_SCRIPTS_ENV_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_SCRIPTS_CMAKE_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_SCRIPTS_GIT_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_SCRIPTS_MESON_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_SCRIPTS_NINJA_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_INSTALL_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_INSTALL_LIB_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_INSTALL_BIN_DIR}")
file(MAKE_DIRECTORY "${BOOTSTRAP_INSTALL_INCLUDE_DIR}")
set(PATH "${BOOTSTRAP_INSTALL_BIN_DIR}")

# Include helpers
include(${CMAKE_CURRENT_LIST_DIR}/helpers.cmake)

# Configure environment components
add_subdirectory(env)

# Detect and build pkgconf if needed
add_subdirectory(pkgconf)

# Propagate environment variables to parent scope
set(ENV_RUNNER ${ENV_RUNNER} PARENT_SCOPE)
set(ENV_RUNNER_SILENT ${ENV_RUNNER_SILENT} PARENT_SCOPE)
set(ENV_CMAKE_COMMAND ${ENV_CMAKE_COMMAND} PARENT_SCOPE)
set(ENV_GIT_COMMAND ${ENV_GIT_COMMAND} PARENT_SCOPE)
set(ENV_MESON_COMMAND ${ENV_MESON_COMMAND} PARENT_SCOPE)
set(ENV_NINJA_COMMAND ${ENV_NINJA_COMMAND} PARENT_SCOPE)
if(DEFINED PKG_CONFIG)
	set(PKG_CONFIG ${PKG_CONFIG} PARENT_SCOPE)
endif()

# Propagate installation directories to parent scope
set(BOOTSTRAP_SRC_DIR "${BOOTSTRAP_SRC_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_BIN_DIR "${BOOTSTRAP_BIN_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_SCRIPTS_DIR "${BOOTSTRAP_SCRIPTS_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_SCRIPTS_ENV_DIR "${BOOTSTRAP_SCRIPTS_ENV_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_SCRIPTS_CMAKE_DIR "${BOOTSTRAP_SCRIPTS_CMAKE_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_SCRIPTS_GIT_DIR "${BOOTSTRAP_SCRIPTS_GIT_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_SCRIPTS_MESON_DIR "${BOOTSTRAP_SCRIPTS_MESON_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_SCRIPTS_NINJA_DIR "${BOOTSTRAP_SCRIPTS_NINJA_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_INSTALL_DIR "${BOOTSTRAP_INSTALL_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_INSTALL_LIB_DIR "${BOOTSTRAP_INSTALL_LIB_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_INSTALL_BIN_DIR "${BOOTSTRAP_INSTALL_BIN_DIR}" PARENT_SCOPE)
set(BOOTSTRAP_INSTALL_INCLUDE_DIR "${BOOTSTRAP_INSTALL_INCLUDE_DIR}" PARENT_SCOPE)
set(PATH "${BOOTSTRAP_INSTALL_BIN_DIR}" PARENT_SCOPE)